<!doctype html><html lang=en><head><title>IBM Model 1 Machine Translation in Python :: Max Nagy</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The IBM model 1 is the original gangster of statistical machine translation. It can learn a dictionary between two languages from a number of translated sentences without any real understanding of language and with a complete disregard for word order.
Even though, we will see that is is able to get meaningful results even from small-ish training sets. While the usual way of explaining its working involves alignments, I find it much more intuitive to think about it as a variant of Von Mises Iteration. In both cases we iteratively move some kind of mass to the most probable solution. Constant normalization of the solution reinforces the most probable solution while suppressing less probable ones.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://maxnagy.com/posts/ibm/><link rel=stylesheet href=https://maxnagy.com/assets/style.css><link rel=stylesheet href=assets/%25!s%28%3cnil%3e%29.css><link rel=apple-touch-icon href=https://maxnagy.com/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://maxnagy.com/img/favicon/orange.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="IBM Model 1 Machine Translation in Python"><meta property="og:description" content="The IBM model 1 is the original gangster of statistical machine translation. It can learn a dictionary between two languages from a number of translated sentences without any real understanding of language and with a complete disregard for word order.
Even though, we will see that is is able to get meaningful results even from small-ish training sets. While the usual way of explaining its working involves alignments, I find it much more intuitive to think about it as a variant of Von Mises Iteration. In both cases we iteratively move some kind of mass to the most probable solution. Constant normalization of the solution reinforces the most probable solution while suppressing less probable ones.
"><meta property="og:url" content="https://maxnagy.com/posts/ibm/"><meta property="og:site_name" content="Max Nagy"><meta property="og:image" content="img/favicon/%!s(<nil>).png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-09-18 10:31:00 +0200 +0200"></head><body><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Max Nagy</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://maxnagy.com/posts/ibm/>IBM Model 1 Machine Translation in Python</a></h1><div class=post-meta><span class=post-date>2023-09-18</span></div><div class=post-content><div><p>The IBM model 1 is the original gangster of statistical machine translation.
It can learn a dictionary between two languages from a number of translated sentences
without any real understanding of language and with a complete disregard for word order.</p><p>Even though, we will see that is is able to get meaningful results even from small-ish
training sets. While the usual way of explaining its working involves alignments, I find
it much more intuitive to think about it as a variant of <a href=https://en.wikipedia.org/wiki/Power_iteration>Von Mises Iteration</a>.
In both cases we iteratively move some kind of mass to the most probable solution. Constant
normalization of the solution reinforces the most probable solution while suppressing less
probable ones.</p><p>We start by asking ChatGPT for some translations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>translations <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;hallo&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;hello&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;guten morgen&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;good morning&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;auf wiedersehen&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;goodbye&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;danke&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;thank you&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;bitte&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;please&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich esse gerne pizza.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i enjoy eating pizza.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das ist ein leckeres gericht.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;this is a delicious dish.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;möchtest du zum abendessen gehen?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;would you like to go for dinner?&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich trinke gerne kaffee am morgen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i like to have coffee in the morning.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;dieses restaurant serviert köstliche pasta.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;this restaurant serves delicious pasta.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich liebe schokoladeneis.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i love chocolate ice cream.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kannst du mir bitte das salz reichen?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;can you please pass me the salt?&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;wir haben gestern abend sushi gegessen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;we had sushi last night.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das restaurant hat eine umfangreiche speisekarte.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the restaurant has an extensive menu.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich mag frisches gemüse in meinem salat.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i like fresh vegetables in my salad.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kannst du bitte das dessert bestellen?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;can you please order dessert?&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das brot ist frisch aus dem ofen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the bread is fresh from the oven.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;meine oma macht die besten pfannkuchen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;my grandma makes the best pancakes.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;wir brauchen noch einige zutaten für das abendessen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;we need a few more ingredients for dinner.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das ist ein traditionelles deutsches gericht.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;this is a traditional german dish.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich koche gerne italienische gerichte.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i enjoy cooking italian dishes.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;der kellner brachte uns die speisekarte.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the waiter brought us the menu.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich habe eine allergie gegen erdnüsse.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i have an allergy to peanuts.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;heute abend machen wir grillen im garten.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tonight, we&#39;re having a barbecue in the garden.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich probiere gerne exotische gerichte.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i enjoy trying exotic dishes.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;die suppe ist noch heiß.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the soup is still hot.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich habe lust auf ein stück schokoladenkuchen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i&#39;m in the mood for a piece of chocolate cake.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;die kellnerin empfahl den fisch des tages.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the waitress recommended the fish of the day.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;wir haben gestern ein neues restaurant ausprobiert.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;we tried a new restaurant yesterday.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;die pizza ist mit peperoni und oliven belegt.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the pizza is topped with pepperoni and olives.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich esse lieber sushi mit stäbchen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i prefer eating sushi with chopsticks.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das restaurant serviert authentische mexikanische tacos.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the restaurant serves authentic mexican tacos.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;möchtest du etwas zum knabbern während des films?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;would you like something to snack on during the movie?&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich habe gestern abend spaghetti bolognese gekocht.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i cooked spaghetti bolognese last night.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das brot schmeckt besonders gut mit butter.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the bread tastes especially good with butter.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das restaurant hat eine tolle auswahl an vorspeisen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the restaurant has a great selection of appetizers.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;in der bäckerei gibt es frische croissants.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;there are fresh croissants available at the bakery.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;die suppe ist gut gewürzt und heiß.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the soup is well-seasoned and hot.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich habe einen tisch für zwei personen reserviert.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i&#39;ve reserved a table for two people.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;heute abend bestellen wir chinesisches essen.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tonight, we&#39;re ordering chinese food.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kannst du mir bitte das salatdressing reichen?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;can you please pass me the salad dressing?&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ich habe eine vorliebe für scharfe gerichte.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;i have a preference for spicy dishes.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;das restaurant bietet vegetarische optionen an.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the restaurant offers vegetarian options.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;die kuchen in dieser bäckerei sind unwiderstehlich.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;the cakes at this bakery are irresistible.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>    (
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;wir planen eine grillparty am samstag.&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;we&#39;re planning a barbecue party on saturday.&#34;</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># do some simple normalization and tokenization</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>pre</span>(s: str) <span style=color:#f92672>-&gt;</span> list[str]:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;,&#34;</span>, <span style=color:#e6db74>&#34; &#34;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;.&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;?&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)<span style=color:#f92672>.</span>lower()<span style=color:#f92672>.</span>split()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># we also swap the tuples so e=english and f=foreign (as is customary for IBM models)</span>
</span></span><span style=display:flex><span>translations <span style=color:#f92672>=</span> [(pre(e), pre(d)) <span style=color:#66d9ef>for</span> d, e <span style=color:#f92672>in</span> translations]
</span></span></code></pre></div><p>The implementation follows the pseudocode of <a href=https://www2.statmt.org/book/>Philipp Koehns Slides</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> collections <span style=color:#f92672>import</span> defaultdict
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: defaultdict(<span style=color:#66d9ef>lambda</span>: <span style=color:#ae81ff>0.1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>100</span>):
</span></span><span style=display:flex><span>    count <span style=color:#f92672>=</span> defaultdict(<span style=color:#66d9ef>lambda</span>: defaultdict(float))
</span></span><span style=display:flex><span>    total <span style=color:#f92672>=</span> defaultdict(float)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    all_words_e <span style=color:#f92672>=</span> set(word <span style=color:#66d9ef>for</span> sentence, _ <span style=color:#f92672>in</span> translations <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> sentence)
</span></span><span style=display:flex><span>    all_words_f <span style=color:#f92672>=</span> set(word <span style=color:#66d9ef>for</span> _, sentence <span style=color:#f92672>in</span> translations <span style=color:#66d9ef>for</span> word <span style=color:#f92672>in</span> sentence)
</span></span><span style=display:flex><span>    s_total <span style=color:#f92672>=</span> defaultdict(float)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> e, f <span style=color:#f92672>in</span> translations:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># calculate how much probability mass each english word will recieve</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> we <span style=color:#f92672>in</span> e:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> wf <span style=color:#f92672>in</span> f:
</span></span><span style=display:flex><span>                s_total[we] <span style=color:#f92672>+=</span> t[we][wf]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># collect</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> we <span style=color:#f92672>in</span> e:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> wf <span style=color:#f92672>in</span> f:
</span></span><span style=display:flex><span>                <span style=color:#75715e># give each english word its probability mass</span>
</span></span><span style=display:flex><span>                count[we][wf] <span style=color:#f92672>+=</span> t[we][wf] <span style=color:#f92672>/</span> s_total[we]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># keep track how much probability mass each foreign word gave away</span>
</span></span><span style=display:flex><span>                total[wf] <span style=color:#f92672>+=</span> t[we][wf] <span style=color:#f92672>/</span> s_total[we]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># estimate probabilities</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> wf <span style=color:#f92672>in</span> all_words_f:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> we <span style=color:#f92672>in</span> all_words_e:
</span></span><span style=display:flex><span>            <span style=color:#75715e># normalize t(e|f), so that \sum_f t(e|f) = 1 for all e, ie we get proper probability distributions.</span>
</span></span><span style=display:flex><span>            t[we][wf] <span style=color:#f92672>=</span> count[we][wf] <span style=color:#f92672>/</span> total[wf]
</span></span></code></pre></div><p>Finally, dump our dictionary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>words_f <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span>words_e <span style=color:#f92672>=</span> set()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> e, f <span style=color:#f92672>in</span> translations:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> we <span style=color:#f92672>in</span> e:
</span></span><span style=display:flex><span>        words_e<span style=color:#f92672>.</span>add(we)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> wf <span style=color:#f92672>in</span> f:
</span></span><span style=display:flex><span>        words_f<span style=color:#f92672>.</span>add(wf)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> we <span style=color:#f92672>in</span> words_e:
</span></span><span style=display:flex><span>    prob, wf <span style=color:#f92672>=</span> max((t[we][wf], wf) <span style=color:#66d9ef>for</span> wf <span style=color:#f92672>in</span> words_f)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> prob <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.9</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># skip unconverged words</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>we<span style=color:#e6db74>}</span><span style=color:#e6db74> -&gt; </span><span style=color:#e6db74>{</span>wf<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#ae81ff>\t</span><span style=color:#e6db74> (</span><span style=color:#e6db74>{</span>prob<span style=color:#e6db74>:</span><span style=color:#e6db74>.2f</span><span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>)
</span></span></code></pre></div><p>The result is pretty impressive, the overwhelming majority of translations are solid:</p><pre tabindex=0><code>extensive -&gt; umfangreiche 	 (0.99)
is -&gt; ist 	 (1.00)
hello -&gt; hallo 	 (1.00)
good -&gt; guten 	 (0.99)
and -&gt; und 	 (1.00)
can -&gt; kannst 	 (1.00)
had -&gt; gegessen 	 (0.99)
dressing -&gt; salatdressing 	 (1.00)
pizza -&gt; pizza 	 (1.00)
eating -&gt; esse 	 (1.00)
serves -&gt; serviert 	 (1.00)
goodbye -&gt; wiedersehen 	 (1.00)
sushi -&gt; sushi 	 (1.00)
please -&gt; bitte 	 (1.00)
dishes -&gt; gerichte 	 (1.00)
an -&gt; eine 	 (0.99)
bread -&gt; brot 	 (1.00)
enjoy -&gt; gerne 	 (0.94)
has -&gt; hat 	 (1.00)
well-seasoned -&gt; gewürzt 	 (1.00)
restaurant -&gt; restaurant 	 (1.00)
menu -&gt; speisekarte 	 (1.00)
salt -&gt; salz 	 (0.99)
with -&gt; mit 	 (1.00)
morning -&gt; morgen 	 (1.00)
</code></pre></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>© 2023 Max Nagy</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://maxnagy.com/assets/main.js></script><script src=https://maxnagy.com/assets/prism.js></script></div></body></html>